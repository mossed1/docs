import { Callout } from 'nextra/components'
import { Steps } from 'nextra/components'

<Callout type="error" emoji="üö´">
TARS-AI is in the early stages of development. You may expect rapid changes to the platform.
</Callout>
<Callout type="warning" emoji="‚ö†Ô∏è">
May be out of date or incomplete. Always confirm on our [Discord](https://discord.gg/uXkqkz3mJJ) for the most up-to-date information.
</Callout>


# Software Setup
TARS-AI is powered by a **modular software stack** designed for real-time speech, vision, and motor control. Follow these instructions to install and set up the TARS-AI environment on your Raspberry Pi.

## Minimum Hardware Prerequisites
1. **Raspberry Pi**: Required for running the setup.
2. **USB Microphone**: For user input.
3. **Speaker**: For TARS output.

## Fresh SD CARD Install using Raspberry Pi Imager
<Steps>
1. Choose Device (RPI5)
2. Choose OS (Raspberry Pi IS (64-bit)
3. Select your SD Card and configure your extras like wifi and username etc.
4. Write image to SD CARD.
</Steps>

## Environment Setup and Installation
<Steps>
1. Open a terminal and run:
   ```bash
   sudo raspi-config
   ```
2. Update the configuration tool.
3. Expand the filesystem under **System Options**.
4. Enable:
   - VNC server
   - SPI
   - I2C
5. Set audio settings under **Advanced Options** ‚Üí **Audio** ‚Üí **PulseAudio**.
6. Reboot the system:
   ```bash
   sudo reboot
   ```
</Steps>

## Install and Configure LCD-show
<Steps>
1. Clone and install the LCD-show driver:
   ```bash
   git clone https://github.com/goodtft/LCD-show.git
   cd LCD-show
   chmod +x LCD35-show
   sudo ./LCD35-show
   ```
   This configures a **3.5-inch 480x320 LCD**.

2. Modify boot configuration for HDMI resolution with VNC:
   ```bash
   sudo nano /boot/config.txt
   ```
   Add or update:
   ```ini
   hdmi_force_hotplug=1
   hdmi_group=2
   hdmi_mode=82  # 1920x1080 resolution
   framebuffer_width=1920
   framebuffer_height=1080
   ```

3. Modify boot configuration for screen rotation:
   ```bash
   sudo nano /boot/config.txt
   ```
   Add:
   ```ini
   dtoverlay=tft35a:rotate=270
   ```

4. Restart the system:
   ```bash
   sudo reboot
</Steps>

## Audio AMP Install
<Steps>
1. Install necessary packages and set up a Python virtual environment:
   ```bash
   sudo apt install python3-venv -y
   python -m venv env --system-site-packages
   source env/bin/activate
   ```

2. Edit the boot configuration file:
   ```bash
   nano /boot/config.txt
   ```

3. Add the following lines at the end of the file:
   ```ini
   dtparam=audio=on
   dtoverlay=hifiberry-dac
   dtoverlay=i2s-mmap
   ```

4. Install required dependencies and setup I2S amplifier:
   ```bash
   sudo apt install -y wget
   pip3 install adafruit-python-shell
   wget https://github.com/adafruit/Raspberry-Pi-Installer-Scripts/raw/main/i2samp.py
   sudo -E env PATH=$PATH python3 i2samp.py
   ```

   **‚ö†Ô∏è DO NOT run audio in the background**, as it will break **VAD (Voice Activity Detection)** and **RMS (Root Mean Square) processing**.

5. Reboot the system:
   ```bash
   sudo reboot
   ```

6. After rebooting, activate the environment and re-run the setup script:
   ```bash
   source env/bin/activate
   sudo -E env PATH=$PATH python3 i2samp.py
   ```

7. Test the speaker output:
   - When prompted, say **yes** to the speaker test and listen for sound.
   - If the audio sounds **distorted**, reduce the volume using `alsamixer`.

8. Enable volume control in **Raspbian Desktop** or **RetroPie**:
   - Reboot the system **again**:
     ```bash
     sudo reboot
     ```
   - After the second reboot, open `alsamixer`:
     ```bash
     alsamixer
     ```
   - Use the **arrow keys** to lower the volume (50% is a good starting point).

9. If audio issues persist:
   - Re-run the `i2samp.py` script.
   - When prompted, choose **N (disable)** for the `/dev/zero` playback service.
</Steps>


### Clone the TARS-AI Repository
<Steps>
1. Open a terminal on your Raspberry Pi.
2. Clone the **TARS-AI** repository:
   ```bash
   git clone https://github.com/pyrater/TARS-AI.git
   ```
3. Navigate to the cloned directory:
   ```bash
   cd TARS-AI
   ```
</Steps>

### Install System Dependencies
<Steps>
To ensure smooth operation, use the included install script.

1. **Update your system**:
   ```bash
   sudo apt update
   sudo apt upgrade -y
   ```
2. **Update script permissions**:
   ```bash
   chmod 777 Install.sh
   ```
3. **Allow the script to be executable**:
   ```bash
   chmod a+x Install.sh
   ```
4. **Run the provided script**:
   ```bash
   sudo ./Install.sh
   ```
</Steps>

### Connect Hardware
1. **Microphone**: Plug a USB microphone into your Raspberry Pi.
2. **Speaker**: Connect an external speaker via **audio jack** or **Bluetooth**.

### Configure API Keys
To enable **LLM** and **TTS** functionality, configure your API keys.

1. Edit the `.env` file and replace `"your-actual-api-key"` with your valid keys:
   ```env
   # LLM API Keys
   OPENAI_API_KEY="your-actual-openai-api-key"
   OOBA_API_KEY="your-actual-ooba-api-key"
   TABBY_API_KEY="your-actual-tabby-api-key"

   # TTS API Keys
   AZURE_API_KEY="your-actual-azure-api-key"
   ```

**Get Your API Keys:**
- [OpenAI API Key](https://www.youtube.com/watch?v=OB99E7Y1cMA)
- [Azure Speech API Key (FREE)](https://www.youtube.com/watch?v=e4_AytZ264Q)
    - Make sure to create a Free Azure account [Free Azure Signup](https://azure.microsoft.com/en-us/pricing/purchase-options/azure-account?icid=azurefreeaccount)
    - Follow all the steps in the video up to `Install Azure speech Python package`.

### Set Up Configuration Parameters
<Steps>
1. Open `src/config.ini` and update the **LLM settings**:
   ```ini
   [LLM]
   llm_backend = openai
   base_url = https://api.openai.com
   openai_model = gpt-4o-mini
   ```
2. Update the **TTS (Text-to-Speech) settings**:
   ```ini
   [TTS]
   ttsoption = azure
   azure_region = eastus
   tts_voice = en-US-Steffan:DragonHDLatestNeural
   ```
</Steps>

### Run the Program
<Steps>
1. Navigate to the source directory:
   ```bash
   cd src/
   ```
2. Start the **TARS-AI assistant**:
   ```bash
   python app.py
   ```
3. TARS-AI is now running! Speak into the microphone and listen to responses from the speaker.

</Steps>

---

## (Optional) Home Assistant Integration
<Steps>
TARS-AI can integrate with **Home Assistant** to enable **smart home automation** via voice commands.

The **Home Assistant integration** allows TARS to:
- **Process voice commands** and trigger smart home actions.
- **Interact with connected devices** (lights, thermostats, security systems, etc.).
- **Leverage Home Assistant's Assistant API** to send prompts and execute actions.

To enable this integration, **TARS-AI must be configured** to communicate with your **Home Assistant server**.

### Prerequisites
Before setting up integration, ensure:
1. **Home Assistant is installed** and running on your local network.
2. **TARS-AI is fully set up** on your Raspberry Pi.
3. **A Home Assistant long-lived access token** is generated.

### Configure Home Assistant in `config.ini`
1. **Open `src/config.ini`** and locate the `[HOME_ASSISTANT]` section.
2. Enable the Home Assistant module and configure the connection URL:
   ```ini
   [HOME_ASSISTANT] # HA Module
   enabled = True
   # If set to False, the Home Assistant module will be disabled.
   url = http://homeassistant.local:8123
   # Example: http://192.168.2.5:8123
   # URL to access Home Assistant (set Token in .env file!).
   ```
3. Adjust the **URL** if your Home Assistant is running on a different address.

### Generate and Add the Access Token
TARS-AI needs a **long-lived access token** to authenticate with Home Assistant.

1. **Log into Home Assistant**.
2. Click on your **User Profile** (bottom left corner).
3. Scroll down to the **Security** section.
4. Locate **"Long-lived access tokens"** and click **"Create Token"**.
5. Enter a name for your token and click **OK**.
6. **Copy the token immediately**, as it won‚Äôt be visible again.

### Store the Access Token in `.env`
1. Open the `.env` file in your TARS-AI directory.
2. Add your **Home Assistant Token**:
   ```env
   HA_TOKEN="INSERT-YOUR-TOKEN-HERE"
   ```
3. Save the file.

### Restart TARS-AI to Apply Changes

1. Navigate to the `src/` directory:
   ```bash
   cd src/
   ```
2. Restart the application:
   ```bash
   python app.py
   ```
</Steps>

Now, TARS-AI can **control smart home devices** with voice commands! üé§üè†

## Next Steps
Now that you've connected to your TARS-AI for the first time, it's time for [testing and your first run](/build/run).

---

<Callout type="default" emoji="üëâ">
  **Documentation Contributors:** @alexander-wang03, @pyrater
</Callout>

